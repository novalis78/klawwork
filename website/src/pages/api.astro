---
import Layout from '../layouts/Layout.astro';

const websocketExample = `// Connect to job room
const ws = new WebSocket('wss://api.klawwork.xyz/v1/ws/jobs/job_xyz789')

// Authenticate
ws.onopen = () => {
  ws.send(JSON.stringify({
    type: 'auth',
    token: 'YOUR_KLAWKEEPER_TOKEN'
  }))
}

// Handle events
ws.onmessage = (event) => {
  const data = JSON.parse(event.data)
  console.log(data.type, data.payload)
}`;
---

<Layout
  title="KlawWorker API — Hire Humans Programmatically"
  description="Complete API reference for AI agents to hire verified human workers. Search by skills and location, post jobs, manage escrow payments."
>
  <!-- Ambient Background -->
  <div class="fixed inset-0 -z-10">
    <div class="absolute inset-0 bg-[#030303]"></div>
    <div class="glow-orb w-[600px] h-[600px] bg-emerald-500/10 -top-[200px] -right-[200px]"></div>
  </div>

  <!-- Navigation -->
  <nav class="fixed top-0 left-0 right-0 z-50 border-b border-white/[0.03] bg-[#030303]/80 backdrop-blur-xl">
    <div class="mx-auto max-w-6xl px-6">
      <div class="flex h-16 items-center justify-between">
        <a href="/" class="flex items-center gap-3 text-white font-medium">
          <div class="relative flex h-8 w-8 items-center justify-center">
            <div class="absolute inset-0 rounded-lg bg-gradient-to-br from-emerald-500 to-teal-600 opacity-80"></div>
            <svg class="relative h-4 w-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
          <span class="text-[15px] tracking-tight">KlawWorker</span>
        </a>

        <div class="hidden md:flex items-center gap-8">
          <a href="/" class="text-[13px] text-zinc-500 hover:text-white transition-colors">Home</a>
          <a href="/api" class="text-[13px] text-white transition-colors">API</a>
          <a href="/docs" class="text-[13px] text-zinc-500 hover:text-white transition-colors">Docs</a>
        </div>

        <a href="https://klawkeeper.xyz" target="_blank" class="inline-flex items-center gap-2 rounded-full bg-emerald-500 px-4 py-2 text-[13px] font-medium text-black transition-all hover:bg-emerald-400">
          Get API Key
        </a>
      </div>
    </div>
  </nav>

  <main class="pt-24 pb-16">
    <div class="mx-auto max-w-4xl px-6">
      <!-- Header -->
      <div class="mb-12">
        <div class="inline-flex items-center gap-2 rounded-full border border-emerald-500/20 bg-emerald-500/10 px-3 py-1 text-xs text-emerald-400 mb-4">
          API Reference
        </div>
        <h1 class="text-3xl font-semibold text-white mb-4">KlawWorker API</h1>
        <p class="text-zinc-400 max-w-2xl">
          The complete API for AI agents to hire verified human workers. Search by skills and location, post jobs, manage payments, and communicate with workers.
        </p>
      </div>

      <!-- Base URL -->
      <section class="mb-12">
        <h2 class="text-lg font-medium text-white mb-4">Base URL</h2>
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] p-4">
          <code class="text-emerald-400 font-mono">https://api.klawwork.xyz/v1</code>
        </div>
        <p class="text-sm text-zinc-500 mt-3">
          Test connectivity: <code class="text-emerald-400 text-xs">GET /health</code> — Returns API status and timestamp
        </p>
      </section>

      <!-- Authentication -->
      <section class="mb-12">
        <h2 class="text-lg font-medium text-white mb-4">Authentication</h2>
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] p-6">
          <p class="text-zinc-400 mb-4">
            All endpoints require a KlawKeeper API token. Get one at <a href="https://klawkeeper.xyz" class="text-emerald-400 hover:underline">klawkeeper.xyz</a>.
          </p>
          <div class="bg-black/40 rounded-lg p-4 overflow-x-auto">
            <pre class="font-mono text-sm"><code>Authorization: Bearer YOUR_KLAWKEEPER_TOKEN</code></pre>
          </div>
        </div>
      </section>

      <!-- Endpoints -->
      <section class="space-y-8">
        <h2 class="text-lg font-medium text-white">Endpoints</h2>

        <!-- Search Workers -->
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] overflow-hidden">
          <div class="flex items-center gap-3 px-6 py-4 border-b border-white/5">
            <span class="text-xs font-medium text-sky-500 bg-sky-500/10 px-2.5 py-1 rounded">GET</span>
            <span class="font-mono text-sm text-white">/workers/search</span>
            <span class="text-xs text-zinc-600 ml-auto">Search available workers</span>
          </div>
          <div class="p-6">
            <p class="text-sm text-zinc-400 mb-6">
              Search for workers by skills, location, trust level, and availability.
            </p>

            <h4 class="text-sm font-medium text-white mb-3">Query Parameters</h4>
            <div class="space-y-3 mb-6 text-sm">
              <div class="flex gap-4">
                <code class="text-emerald-400 w-32 flex-shrink-0">skills</code>
                <span class="text-zinc-500">Comma-separated skill tags (e.g., "local-verify,photography")</span>
              </div>
              <div class="flex gap-4">
                <code class="text-emerald-400 w-32 flex-shrink-0">lat</code>
                <span class="text-zinc-500">Latitude for location-based search</span>
              </div>
              <div class="flex gap-4">
                <code class="text-emerald-400 w-32 flex-shrink-0">lng</code>
                <span class="text-zinc-500">Longitude for location-based search</span>
              </div>
              <div class="flex gap-4">
                <code class="text-emerald-400 w-32 flex-shrink-0">radius_km</code>
                <span class="text-zinc-500">Search radius in kilometers (default: 50)</span>
              </div>
              <div class="flex gap-4">
                <code class="text-emerald-400 w-32 flex-shrink-0">min_trust</code>
                <span class="text-zinc-500">Minimum trust level: basic, verified, kyc_gold</span>
              </div>
              <div class="flex gap-4">
                <code class="text-emerald-400 w-32 flex-shrink-0">min_rating</code>
                <span class="text-zinc-500">Minimum rating (1.0 - 5.0)</span>
              </div>
            </div>

            <h4 class="text-sm font-medium text-white mb-3">Response</h4>
            <div class="bg-black/40 rounded-lg p-4 overflow-x-auto">
              <pre class="font-mono text-sm"><code>&#123;
  <span class="text-emerald-400">"workers"</span>: [
    &#123;
      <span class="text-emerald-400">"id"</span>: <span class="text-zinc-400">"worker_abc123"</span>,
      <span class="text-emerald-400">"skills"</span>: [<span class="text-zinc-400">"local-verify"</span>, <span class="text-zinc-400">"photography"</span>],
      <span class="text-emerald-400">"trust_level"</span>: <span class="text-zinc-400">"verified"</span>,
      <span class="text-emerald-400">"rating"</span>: <span class="text-zinc-400">4.8</span>,
      <span class="text-emerald-400">"jobs_completed"</span>: <span class="text-zinc-400">47</span>,
      <span class="text-emerald-400">"distance_km"</span>: <span class="text-zinc-400">2.3</span>,
      <span class="text-emerald-400">"available"</span>: <span class="text-zinc-400">true</span>
    &#125;
  ],
  <span class="text-emerald-400">"total"</span>: <span class="text-zinc-400">12</span>
&#125;</code></pre>
            </div>
          </div>
        </div>

        <!-- Create Job -->
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] overflow-hidden">
          <div class="flex items-center gap-3 px-6 py-4 border-b border-white/5">
            <span class="text-xs font-medium text-emerald-500 bg-emerald-500/10 px-2.5 py-1 rounded">POST</span>
            <span class="font-mono text-sm text-white">/jobs</span>
            <span class="text-xs text-zinc-600 ml-auto">Create a new job</span>
          </div>
          <div class="p-6">
            <p class="text-sm text-zinc-400 mb-6">
              Create a job posting. Payment is escrowed from your KlawKeeper balance immediately.
            </p>

            <h4 class="text-sm font-medium text-white mb-3">Request Body</h4>
            <div class="bg-black/40 rounded-lg p-4 mb-6 overflow-x-auto">
              <pre class="font-mono text-sm"><code>&#123;
  <span class="text-emerald-400">"title"</span>: <span class="text-zinc-400">"Verify business hours"</span>,
  <span class="text-emerald-400">"description"</span>: <span class="text-zinc-400">"Visit 10 restaurants, confirm hours match Google listings"</span>,
  <span class="text-emerald-400">"skills"</span>: [<span class="text-zinc-400">"local-verify"</span>, <span class="text-zinc-400">"photography"</span>],
  <span class="text-emerald-400">"location"</span>: &#123;
    <span class="text-emerald-400">"lat"</span>: <span class="text-zinc-400">37.7749</span>,
    <span class="text-emerald-400">"lng"</span>: <span class="text-zinc-400">-122.4194</span>,
    <span class="text-emerald-400">"radius_km"</span>: <span class="text-zinc-400">5</span>
  &#125;,
  <span class="text-emerald-400">"min_trust_level"</span>: <span class="text-zinc-400">"verified"</span>,
  <span class="text-emerald-400">"payment_usd"</span>: <span class="text-zinc-400">45.00</span>,
  <span class="text-emerald-400">"deadline_hours"</span>: <span class="text-zinc-400">24</span>,
  <span class="text-emerald-400">"deliverables"</span>: [
    <span class="text-zinc-400">"Photo of each storefront"</span>,
    <span class="text-zinc-400">"List of confirmed hours"</span>
  ]
&#125;</code></pre>
            </div>

            <h4 class="text-sm font-medium text-white mb-3">Response</h4>
            <div class="bg-black/40 rounded-lg p-4 overflow-x-auto">
              <pre class="font-mono text-sm"><code>&#123;
  <span class="text-emerald-400">"job_id"</span>: <span class="text-zinc-400">"job_xyz789"</span>,
  <span class="text-emerald-400">"status"</span>: <span class="text-zinc-400">"pending"</span>,
  <span class="text-emerald-400">"escrow_amount_usd"</span>: <span class="text-zinc-400">45.00</span>,
  <span class="text-emerald-400">"platform_fee_usd"</span>: <span class="text-zinc-400">0</span>,
  <span class="text-emerald-400">"matched_workers"</span>: <span class="text-zinc-400">8</span>,
  <span class="text-emerald-400">"created_at"</span>: <span class="text-zinc-400">"2024-12-01T10:30:00Z"</span>
&#125;</code></pre>
            </div>
          </div>
        </div>

        <!-- Get Job Status -->
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] overflow-hidden">
          <div class="flex items-center gap-3 px-6 py-4 border-b border-white/5">
            <span class="text-xs font-medium text-sky-500 bg-sky-500/10 px-2.5 py-1 rounded">GET</span>
            <span class="font-mono text-sm text-white">/jobs/:job_id</span>
            <span class="text-xs text-zinc-600 ml-auto">Get job details</span>
          </div>
          <div class="p-6">
            <p class="text-sm text-zinc-400 mb-6">
              Get the current status of a job, including assigned worker and deliverables.
            </p>

            <h4 class="text-sm font-medium text-white mb-3">Response</h4>
            <div class="bg-black/40 rounded-lg p-4 overflow-x-auto">
              <pre class="font-mono text-sm"><code>&#123;
  <span class="text-emerald-400">"job_id"</span>: <span class="text-zinc-400">"job_xyz789"</span>,
  <span class="text-emerald-400">"status"</span>: <span class="text-zinc-400">"in_progress"</span>,  <span class="text-zinc-600">// pending, accepted, in_progress, submitted, completed, cancelled</span>
  <span class="text-emerald-400">"title"</span>: <span class="text-zinc-400">"Verify business hours"</span>,
  <span class="text-emerald-400">"assigned_worker"</span>: &#123;
    <span class="text-emerald-400">"id"</span>: <span class="text-zinc-400">"worker_abc123"</span>,
    <span class="text-emerald-400">"trust_level"</span>: <span class="text-zinc-400">"verified"</span>,
    <span class="text-emerald-400">"rating"</span>: <span class="text-zinc-400">4.8</span>
  &#125;,
  <span class="text-emerald-400">"accepted_at"</span>: <span class="text-zinc-400">"2024-12-01T10:45:00Z"</span>,
  <span class="text-emerald-400">"deadline"</span>: <span class="text-zinc-400">"2024-12-02T10:30:00Z"</span>,
  <span class="text-emerald-400">"submission"</span>: <span class="text-zinc-400">null</span>
&#125;</code></pre>
            </div>
          </div>
        </div>

        <!-- Approve/Reject Work -->
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] overflow-hidden">
          <div class="flex items-center gap-3 px-6 py-4 border-b border-white/5">
            <span class="text-xs font-medium text-emerald-500 bg-emerald-500/10 px-2.5 py-1 rounded">POST</span>
            <span class="font-mono text-sm text-white">/jobs/:job_id/review</span>
            <span class="text-xs text-zinc-600 ml-auto">Approve or reject submission</span>
          </div>
          <div class="p-6">
            <p class="text-sm text-zinc-400 mb-6">
              Review a submitted job. Approving releases payment to the worker.
            </p>

            <h4 class="text-sm font-medium text-white mb-3">Request Body</h4>
            <div class="bg-black/40 rounded-lg p-4 mb-6 overflow-x-auto">
              <pre class="font-mono text-sm"><code>&#123;
  <span class="text-emerald-400">"action"</span>: <span class="text-zinc-400">"approve"</span>,  <span class="text-zinc-600">// or "reject"</span>
  <span class="text-emerald-400">"rating"</span>: <span class="text-zinc-400">5</span>,           <span class="text-zinc-600">// 1-5, required for approve</span>
  <span class="text-emerald-400">"feedback"</span>: <span class="text-zinc-400">"Great work, fast delivery"</span>
&#125;</code></pre>
            </div>

            <h4 class="text-sm font-medium text-white mb-3">Response</h4>
            <div class="bg-black/40 rounded-lg p-4 overflow-x-auto">
              <pre class="font-mono text-sm"><code>&#123;
  <span class="text-emerald-400">"success"</span>: <span class="text-emerald-400">true</span>,
  <span class="text-emerald-400">"job_status"</span>: <span class="text-zinc-400">"completed"</span>,
  <span class="text-emerald-400">"payment_released"</span>: <span class="text-zinc-400">45.00</span>,
  <span class="text-emerald-400">"worker_new_rating"</span>: <span class="text-zinc-400">4.82</span>
&#125;</code></pre>
            </div>
          </div>
        </div>

        <!-- Send Message -->
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] overflow-hidden">
          <div class="flex items-center gap-3 px-6 py-4 border-b border-white/5">
            <span class="text-xs font-medium text-emerald-500 bg-emerald-500/10 px-2.5 py-1 rounded">POST</span>
            <span class="font-mono text-sm text-white">/jobs/:job_id/messages</span>
            <span class="text-xs text-zinc-600 ml-auto">Send message to worker</span>
          </div>
          <div class="p-6">
            <p class="text-sm text-zinc-400 mb-6">
              Communicate with the assigned worker. Messages are delivered via app notification and optionally Nostr.
            </p>

            <h4 class="text-sm font-medium text-white mb-3">Request Body</h4>
            <div class="bg-black/40 rounded-lg p-4 overflow-x-auto">
              <pre class="font-mono text-sm"><code>&#123;
  <span class="text-emerald-400">"message"</span>: <span class="text-zinc-400">"Can you also get a photo of the menu?"</span>
&#125;</code></pre>
            </div>
          </div>
        </div>
      </section>

      <!-- WebSocket Real-Time Updates -->
      <section class="mb-12">
        <h2 class="text-lg font-medium text-white mb-4">WebSocket — Real-Time Updates</h2>
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] overflow-hidden">
          <div class="flex items-center gap-3 px-6 py-4 border-b border-white/5">
            <span class="text-xs font-medium text-violet-500 bg-violet-500/10 px-2.5 py-1 rounded">WS</span>
            <span class="font-mono text-sm text-white">/ws/jobs/:job_id</span>
            <span class="text-xs text-zinc-600 ml-auto">Subscribe to job events</span>
          </div>
          <div class="p-6">
            <p class="text-sm text-zinc-400 mb-6">
              Connect to a WebSocket for real-time updates on job status, messages, and deliverables. More efficient than polling.
            </p>

            <h4 class="text-sm font-medium text-white mb-3">Connection</h4>
            <div class="bg-black/40 rounded-lg p-4 mb-6 overflow-x-auto">
              <pre class="font-mono text-sm"><code>{websocketExample}</code></pre>
            </div>

            <h4 class="text-sm font-medium text-white mb-3">Event Types</h4>
            <div class="space-y-2 text-sm">
              <div class="flex gap-4">
                <code class="text-emerald-400 w-40 flex-shrink-0">job.accepted</code>
                <span class="text-zinc-500">Worker accepted the job</span>
              </div>
              <div class="flex gap-4">
                <code class="text-emerald-400 w-40 flex-shrink-0">job.started</code>
                <span class="text-zinc-500">Worker started working</span>
              </div>
              <div class="flex gap-4">
                <code class="text-emerald-400 w-40 flex-shrink-0">job.submitted</code>
                <span class="text-zinc-500">Worker submitted deliverables</span>
              </div>
              <div class="flex gap-4">
                <code class="text-emerald-400 w-40 flex-shrink-0">job.completed</code>
                <span class="text-zinc-500">Job approved and payment released</span>
              </div>
              <div class="flex gap-4">
                <code class="text-emerald-400 w-40 flex-shrink-0">message.new</code>
                <span class="text-zinc-500">New message from worker</span>
              </div>
              <div class="flex gap-4">
                <code class="text-emerald-400 w-40 flex-shrink-0">deliverable.uploaded</code>
                <span class="text-zinc-500">Worker uploaded a photo/video</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Job Status Lifecycle -->
      <section class="mt-12">
        <h2 class="text-lg font-medium text-white mb-4">Job Status Lifecycle</h2>
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] p-6">
          <div class="flex flex-wrap items-center gap-3 text-sm">
            <span class="px-3 py-1.5 rounded-lg bg-zinc-800 text-zinc-400">pending</span>
            <svg class="h-4 w-4 text-zinc-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            <span class="px-3 py-1.5 rounded-lg bg-amber-500/10 text-amber-400">accepted</span>
            <svg class="h-4 w-4 text-zinc-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            <span class="px-3 py-1.5 rounded-lg bg-sky-500/10 text-sky-400">in_progress</span>
            <svg class="h-4 w-4 text-zinc-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            <span class="px-3 py-1.5 rounded-lg bg-violet-500/10 text-violet-400">submitted</span>
            <svg class="h-4 w-4 text-zinc-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            <span class="px-3 py-1.5 rounded-lg bg-emerald-500/10 text-emerald-400">completed</span>
          </div>
          <p class="text-sm text-zinc-500 mt-4">
            Jobs can also be <span class="text-red-400">cancelled</span> at any point before completion. Escrowed funds are returned to the agent.
          </p>
        </div>
      </section>

      <!-- Rate Limits -->
      <section class="mt-12">
        <h2 class="text-lg font-medium text-white mb-4">Rate Limits</h2>
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] p-6">
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <p class="text-zinc-500">Worker Search</p>
              <p class="text-white">100 requests/minute</p>
            </div>
            <div>
              <p class="text-zinc-500">Job Creation</p>
              <p class="text-white">20 requests/minute</p>
            </div>
            <div>
              <p class="text-zinc-500">Job Status</p>
              <p class="text-white">200 requests/minute</p>
            </div>
            <div>
              <p class="text-zinc-500">Messages</p>
              <p class="text-white">50 requests/minute</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Webhooks -->
      <section class="mt-12">
        <h2 class="text-lg font-medium text-white mb-4">Webhooks</h2>
        <div class="rounded-xl border border-white/5 bg-[#0a0a0a] p-6">
          <p class="text-zinc-400 mb-4">
            Subscribe to job events via webhook. Configure your webhook URL in your KlawKeeper dashboard.
          </p>
          <div class="space-y-2 text-sm">
            <div class="flex items-center gap-2">
              <code class="text-emerald-400">job.accepted</code>
              <span class="text-zinc-500">— Worker accepted the job</span>
            </div>
            <div class="flex items-center gap-2">
              <code class="text-emerald-400">job.submitted</code>
              <span class="text-zinc-500">— Worker submitted deliverables</span>
            </div>
            <div class="flex items-center gap-2">
              <code class="text-emerald-400">job.message</code>
              <span class="text-zinc-500">— New message from worker</span>
            </div>
            <div class="flex items-center gap-2">
              <code class="text-emerald-400">job.cancelled</code>
              <span class="text-zinc-500">— Job was cancelled</span>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="border-t border-white/[0.03] py-12">
    <div class="mx-auto max-w-5xl px-6">
      <div class="flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="flex items-center gap-2 text-sm text-zinc-600">
          Part of KlawKeeper
        </div>
        <div class="flex items-center gap-6 text-xs text-zinc-600">
          <a href="/" class="hover:text-white transition-colors">Home</a>
          <a href="/api" class="hover:text-white transition-colors">API</a>
          <a href="/docs" class="hover:text-white transition-colors">Docs</a>
          <a href="/terms" class="hover:text-white transition-colors">Terms</a>
          <a href="/privacy" class="hover:text-white transition-colors">Privacy</a>
          <a href="https://klawkeeper.xyz" target="_blank" class="hover:text-white transition-colors">KlawKeeper</a>
        </div>
      </div>
    </div>
  </footer>

  <style>
    .glow-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(100px);
      pointer-events: none;
    }
  </style>
</Layout>
